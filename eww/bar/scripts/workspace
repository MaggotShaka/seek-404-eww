#!/bin/bash

# Función para generar el widget de EWW para Hyprland
get_workspaces() {
  # Obtener el workspace enfocado actualmente
  focused=$(hyprctl monitors -j | jq '.[] | select(.focused == true) | .activeWorkspace.id')

  echo "(box :class \"works\" :orientation \"h\" :space-evenly true :spacing 10"
  
  for i in {1..4}; do
    # Determinar la clase: 'ws-focused' si es el actual, 'ws-normal' si no
    if [ "$i" -eq "$focused" ]; then
      class="ws-focused"
    else
      class="ws-normal"
    fi
    
    # Usaremos puntitos elegantes: ● para enfocado, ○ para normal
    # O puedes usar números: 1 2 3 4
    if [ "$i" -eq "$focused" ]; then
        icon=""
    else
        icon=""
    fi

    echo "(button :onclick \"hyprctl dispatch workspace $i\" :class \"$class\" \"$icon\")"
  done
  
  echo ")"
}

# Ejecutar inicialmente
get_workspaces

# Escuchar eventos de Hyprland para actualizar al instante
socat -u "UNIX-CONNECT:$XDG_RUNTIME_DIR/hypr/$HYPRLAND_INSTANCE_SIGNATURE/.socket2.sock" - | while read -r line; do
  get_workspaces
done
